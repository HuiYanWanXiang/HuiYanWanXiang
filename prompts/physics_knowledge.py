#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
================================================================================
项目名称: 绘演万象：Web端交互式物理仿真实验平台
模块名称: Physics Knowledge Base (物理学科预设知识库)
文件路径: prompts/physics_knowledge.py
创建日期: 2026-02-06
作者: 大连理工大学开发团队
版本: V1.0.0

版权所有 (C) 2026 大连理工大学. 保留所有权利.

模块描述:
本模块存储了基于高中及大学物理课程标准的预设提示词模板。
用于辅助大语言模型（LLM）更精准地生成特定物理模型的仿真代码。
包含：力学、电磁学、波动学、光学、热学、量子力学等核心领域的数学描述与可视化要求。
================================================================================
"""

# 物理模型提示词字典
PHYSICS_PROMPTS = {
    # =========================================================
    # 第一部分：经典力学 (Classical Mechanics)
    # =========================================================
    "mechanics_damped_oscillation": """
    【角色设定】
    你是一个精通理论力学和Web可视化技术的前端专家。
    
    【物理模型：阻尼振动 (Damped Oscillation)】
    1. 核心微分方程：
       $$ m \frac{d^2x}{dt^2} + b \frac{dx}{dt} + kx = 0 $$
    2. 参数定义：
       - m (mass): 振子质量，单位 kg，推荐范围 0.1 ~ 10.0。
       - b (damping): 阻尼系数，单位 Ns/m，推荐范围 0.0 ~ 5.0。
       - k (stiffness): 劲度系数，单位 N/m，推荐范围 1.0 ~ 100.0。
    3. 阻尼状态分类：
       - 过阻尼 (Over-damped): b^2 > 4mk，系统不发生振荡，缓慢回到平衡位置。
       - 临界阻尼 (Critically damped): b^2 = 4mk，系统以最快速度回到平衡位置且不超调。
       - 欠阻尼 (Under-damped): b^2 < 4mk，系统围绕平衡位置进行振幅衰减的振动。
    
    【可视化需求】
    1. 左侧画布：绘制弹簧振子示意图（墙壁、弹簧、滑块）。
    2. 右侧画布：动态绘制位移-时间 (x-t) 曲线，要求曲线平滑。
    3. 交互控制：提供 m, b, k 的滑块，拖动时实时更新动画。
    4. 能量显示：实时计算动能 (Ek) 和 势能 (Ep) 并显示柱状图。
    """,

    "mechanics_projectile_motion": """
    【角色设定】
    你是一个精通运动学的物理仿真工程师。
    
    【物理模型：斜抛运动 (Projectile Motion)】
    1. 核心方程（忽略空气阻力）：
       $$ x(t) = v_0 \cos(\theta) \cdot t $$
       $$ y(t) = v_0 \sin(\theta) \cdot t - \frac{1}{2} g t^2 $$
    2. 考虑空气阻力（线性阻力 f = -kv）：
       $$ m a_x = -k v_x $$
       $$ m a_y = -mg - k v_y $$
    3. 关键参数：
       - v0: 初速度
       - theta: 发射角度
       - g: 重力加速度 (9.8 m/s^2)
       - k: 空气阻力系数
    
    【可视化需求】
    1. 绘制地面网格与大炮图标。
    2. 绘制炮弹轨迹，保留“轨迹残影”效果。
    3. 实时显示当前高度、速度矢量方向。
    4. 增加“击中目标”判定逻辑，在特定坐标设置靶心。
    """,

    "mechanics_newton_cradle": """
    【角色设定】
    你是一个精通刚体碰撞模拟的算法工程师。
    
    【物理模型：牛顿摆 (Newton's Cradle)】
    1. 原理：动量守恒定律与机械能守恒定律。
    2. 碰撞逻辑：
       - 假设为完全弹性碰撞 (Perfectly Elastic Collision)。
       - 质量相同的两个小球碰撞，交换速度。
    3. 复杂性：
       - 需要模拟多体碰撞的传递过程。
       - 考虑非理想情况下的能量损耗（恢复系数 e < 1）。
    
    【可视化需求】
    1. 绘制 5 个悬挂的小球，具有金属质感（径向渐变填充）。
    2. 支持拖动第一个或前两个小球并释放。
    3. 动画帧率需稳定在 60FPS 以保证碰撞瞬间的流畅性。
    """,

    # =========================================================
    # 第二部分：波动学与声学 (Waves & Acoustics)
    # =========================================================
    "wave_double_slit_interference": """
    【角色设定】
    你是一个精通波动光学的物理专家。
    
    【物理模型：杨氏双缝干涉 (Young's Double Slit Interference)】
    1. 原理：两列相干光波在空间叠加，形成明暗相间的条纹。
    2. 光程差公式：
       $$ \Delta r = d \sin(\theta) \approx d \frac{x}{L} $$
    3. 条纹条件：
       - 亮条纹 (Constructive): \Delta r = k \lambda
       - 暗条纹 (Destructive): \Delta r = (k + 0.5) \lambda
    
    【代码实现要求】
    1. 使用 HTML5 Canvas 的 ImageData 对象进行像素级操作。
    2. 计算屏幕上每个像素点到两个波源的距离差。
    3. 根据相位差计算光强：I = I0 * cos^2(\delta / 2)。
    4. 颜色渲染：根据波长（400nm-700nm）自动转换 RGB 颜色。
    """,

    "wave_doppler_effect": """
    【角色设定】
    你是一个声学信号处理专家。
    
    【物理模型：多普勒效应 (Doppler Effect)】
    1. 频率变换公式：
       $$ f' = f \left( \frac{v \pm v_o}{v \mp v_s} \right) $$
       - v: 波速 (声速 ~340m/s)
       - vo: 观察者速度
       - vs: 波源速度
    2. 激波 (Shock Wave)：
       - 当 vs > v 时，形成马赫锥 (Mach Cone)。
    
    【可视化需求】
    1. 动态绘制波源（小车）和波阵面（同心圆）。
    2. 波源移动时，前方的波长变短，后方的波长变长。
    3. 底部绘制频率-时间曲线图，展示频率的突变。
    """,

    # =========================================================
    # 第三部分：电磁学 (Electromagnetism)
    # =========================================================
    "em_electric_field_lines": """
    【角色设定】
    你是一个电磁场仿真专家。
    
    【物理模型：点电荷电场线 (Electric Field Lines)】
    1. 库仑定律：
       $$ F = k_e \frac{q_1 q_2}{r^2} $$
    2. 电场强度叠加原理：
       $$ \vec{E} = \sum \vec{E_i} $$
    
    【算法要求】
    1. 在画布上放置正电荷（红色）和负电荷（蓝色）。
    2. 使用流线追踪算法 (Streamline Tracing) 绘制电场线。
    3. 从正电荷出发，沿着 E 向量方向步进，直到遇到负电荷或超出边界。
    4. 绘制等势面 (Equipotential Lines)，与电场线垂直。
    """,

    "em_lorentz_force": """
    【角色设定】
    你是一个粒子物理仿真专家。
    
    【物理模型：带电粒子在磁场中的运动】
    1. 洛伦兹力公式：
       $$ \vec{F} = q (\vec{v} \times \vec{B}) $$
    2. 运动轨迹：
       - 速度垂直于磁场：匀速圆周运动，半径 R = mv / qB。
       - 速度与磁场有夹角：螺旋线运动 (Helical Motion)。
    
    【可视化需求】
    1. 3D 视角投影（或伪 3D）。
    2. 绘制磁感线方向。
    3. 粒子运动留下明显的轨迹尾迹。
    4. 提供滑块调节 B 的大小和粒子的初速度 v。
    """,
    
    # =========================================================
    # 第四部分：数学几何 (Math & Geometry)
    # =========================================================
    "math_pythagorean_theorem": """
    【角色设定】
    你是一个数学可视化教育专家。
    
    【数学模型：勾股定理 (Pythagorean Theorem)】
    1. 公式：a^2 + b^2 = c^2
    2. 几何证明方法：
       - 毕达哥拉斯拼图法
       - 欧几里得风车证明法
       - 赵爽弦图
    
    【交互设计】
    1. 绘制直角三角形及其三边对应的正方形。
    2. 拖动顶点改变直角边的长度。
    3. 实时显示面积数据：Area_A + Area_B = Area_C。
    4. 添加“流体演示”模式：水从两个小正方形流向大正方形。
    """,
    
    "math_fourier_series": """
    【角色设定】
    你是一个信号处理与数学可视化专家。
    
    【数学模型：傅里叶级数 (Fourier Series)】
    1. 原理：任何周期函数都可以分解为一系列正弦波的叠加。
    2. 公式：
       $$ f(x) = a_0 + \sum_{n=1}^{\infty} (a_n \cos(nx) + b_n \sin(nx)) $$
    
    【可视化需求】
    1. 经典的“圆圈套圆圈” (Epicycles) 动画。
    2. 左侧显示旋转的向量，右侧绘制生成的波形。
    3. 提供预设波形选择：方波、锯齿波、三角波。
    4. 滑块调节项数 N，展示逼近过程。
    """,

    # =========================================================
    # 第五部分：热力学 (Thermodynamics) - 新增扩充
    # =========================================================
    "thermo_ideal_gas": """
    【角色设定】
    你是一个热力学仿真专家。
    
    【物理模型：理想气体状态方程 (Ideal Gas Law)】
    1. 核心公式：PV = nRT
       - P: 压强 (Pa)
       - V: 体积 (m^3)
       - n: 物质的量 (mol)
       - R: 理想气体常数 (8.314 J/(mol·K))
       - T: 温度 (K)
    2. 分子运动论：
       - 分子平均动能：Ek = (3/2)kT
       - 均方根速度：v_rms = sqrt(3RT/M)
    
    【可视化需求】
    1. 绘制一个密闭容器（活塞可移动）。
    2. 容器内有大量粒子（小球）做无规则布朗运动。
    3. 粒子碰撞墙壁时反弹。
    4. 交互：
       - 拖动活塞改变体积 V -> 粒子密度改变，压强改变。
       - 滑块调节温度 T -> 粒子运动速度改变。
    5. 图表：实时绘制 P-V 图像（等温线）。
    """,

    "thermo_carnot_cycle": """
    【角色设定】
    你是一个能源动力工程专家。
    
    【物理模型：卡诺循环 (Carnot Cycle)】
    1. 四个过程：
       - 等温膨胀 (Isothermal Expansion)
       - 绝热膨胀 (Adiabatic Expansion)
       - 等温压缩 (Isothermal Compression)
       - 绝热压缩 (Adiabatic Compression)
    2. 效率公式：
       $$ \eta = 1 - \frac{T_C}{T_H} $$
    
    【可视化需求】
    1. 动态演示气缸活塞的四个冲程。
    2. 同步绘制 P-V 图和 T-S 图，当前状态点在曲线上移动。
    3. 用颜色表示吸热（红色）和放热（蓝色）。
    """,

    # =========================================================
    # 第六部分：量子力学 (Quantum Mechanics) - 新增扩充
    # =========================================================
    "quantum_infinite_well": """
    【角色设定】
    你是一个量子物理可视化专家。
    
    【物理模型：一维无限深势阱 (Infinite Potential Well)】
    1. 薛定谔方程定态解：
       $$ \psi_n(x) = \sqrt{\frac{2}{a}} \sin\left(\frac{n\pi x}{a}\right) $$
    2. 能级公式：
       $$ E_n = \frac{n^2 \pi^2 \hbar^2}{2ma^2} $$
    3. 概率密度：
       $$ P(x) = |\psi_n(x)|^2 $$
    
    【可视化需求】
    1. 绘制势阱边界（x=0 到 x=a）。
    2. 绘制波函数 ψ(x) 的实部和虚部动画（复数旋转）。
    3. 绘制概率密度 |ψ|^2 的静态曲线。
    4. 滑块调节量子数 n (1-10)，观察波节点数量的变化。
    """,
    
    "quantum_tunneling": """
    【角色设定】
    你是一个量子力学仿真专家。
    
    【物理模型：量子隧穿效应 (Quantum Tunneling)】
    1. 场景：粒子遭遇势垒 (Potential Barrier)，能量 E < V0。
    2. 经典预测：粒子100%被反射。
    3. 量子预测：有非零概率透射到势垒另一侧。
    4. 波函数特征：
       - 势垒前：入射波 + 反射波 (干涉震荡)
       - 势垒中：指数衰减 (Exponential Decay)
       - 势垒后：透射波 (振幅减小)
    
    【可视化需求】
    1. 动态展示波包 (Wave Packet) 撞击势垒的过程。
    2. 使用颜色深浅表示概率密度。
    3. 滑块调节势垒宽度和高度，观察透射率的变化。
    """
}

def get_physics_prompt(topic_key):
    """
    根据主题键获取对应的物理模型提示词
    :param topic_key: 知识库中的键值
    :return: 对应的提示词字符串，如果未找到则返回 None
    """
    return PHYSICS_PROMPTS.get(topic_key, None)

if __name__ == "__main__":
    # 简单的自我测试
    print(f"当前知识库包含模型数量: {len(PHYSICS_PROMPTS)}")
    print("测试读取 'damped_oscillation':")
    # 增加异常处理防止key不存在报错
    prompt = get_physics_prompt("mechanics_damped_oscillation")
    if prompt:
        print(prompt[:100] + "...")
    else:
        print("未找到指定模型。")